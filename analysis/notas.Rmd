---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r packages, message=FALSE}
library("leaflet")
library("rgdal")

```

```{r}
## Read gpx file 

my_gpx <- '/Users/ajpeluLap/Dropbox/EXCURSIONES/georoutes/2016_08_mulhacen.GPX'

m <- readOGR(my_gpx, layer = 'track_points')

str(m)





hike.dists <- spDists(m, segments=TRUE)
sum(hike.dists)

m$time <- ymd_hms(m$time)   # convert timestamps to datetime-objects

p <- ggplot(as.data.frame(m), # convert to regular dataframe
            aes(x=track_seg_point_id, y=ele)) 
p + geom_line()
  geom_point() + labs(x='Hiking time', y='Elevations (meters)')

  
  
library(ggploty)

```

### Notas 
#### MAPA 

* PERFIL 
* GGPLOTY O https://rstudio.github.io/dygraphs/
    
* MAPA de plotkml (intercativo ) http://gsif.isric.org/doku.php/wiki:tutorial_plotkml 




## Read Sierra Nevada limits
enp <- rgdal::readOGR(dsn='/Users/ajpeluLap/Downloads/EENNPP/InfGeografica/InfVectorial/Shapes/ED50_30', 
                      layer = 'EENNPP', verbose = FALSE)

sn <- subset(enp, NOMBRE == 'SIERRA NEVADA' & FIGURA == 'Espacio Natural')

# Reproject to lat / lon W

# reproject naamp to lat/lon WGS84 ("geographic projection")
sn_ll <- spTransform(sn, CRS("+proj=longlat"))

```{r}
notas 
library(leaflet)

ib <- leaflet() %>% 
  setView(lng=-3.69, lat=40, zoom=5) %>%
  addProviderTiles('Esri.WorldShadedRelief')
  #addProviderTiles('Stamen.TerrainBackground')

print(ib)
    
  )
mymap <- leaflet() %>% 
  setView(-3, 37, zoom=8) %>% 
 addProviderTiles('Esri.WorldShadedRelief') %>%
#   # addWMSTiles('http://www.juntadeandalucia.es/medioambiente/mapwms/REDIAM_mapa_guia_pn_sierra_nevada_2007?',
#               layers = '1',
#               options = WMSTileOptions(format = "image/png", transparent = TRUE),
              # attribution = "") %>%
  addPolygons(sn_ll, stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5)
    
    
print(mymap)

states <- readOGR('/Users/ajpeluLap/Downloads/EENNPP/InfGeografica/InfVectorial/Shapes/ED50_30/EENNPP.shp', 
                  layer='EENNPP', verbose = FALSE)

sn <- subset(states, FIGURA == 'Espacio Natural', NOMBRE == 'SIERRA NEVADA')


leaflet() %>% 
  addPolygons(stroke = FALSE, fillOpacity = 0.5, smoothFactor = 0.5, color='red')


library(maptools)
sn <- readShapePoly('/Users/ajpeluLap/Dropbox/LTER_2014_mipollica/LTER_sites_geoinfo/Sierra_Nevada/PPNacyNat_SN_REDIAM_Dic15.shp')


# Read Protected Areas boundaries
eennpp <- readShapePoly('/Users/ajpeluLap/Downloads/EENNPP/InfGeografica/InfVectorial/Shapes/ED50_30/EENNPP.shp')
sn <- subset(eennpp, eennpp@data$NOMBRE == 'SIERRA NEVADA', ) 
sn <- subset(sn, sn@data$FIGURA == 'Espacio Natural')

# Set ED50 
proj4string(sn) <- CRS("+init=epsg:23030")  





# Convert to lat long 
spTransform(hrr.shp, CRS("+init=epsg:26978"))



summary(sn@data$FIGURA)
sn



neStates <- subset(states, states$STUSPS %in% c(
  "CT","ME","MA","NH","RI","VT","NY","NJ","PA"
))

SpatialPolygonsDataFrame




/Users/ajpeluLap/Dropbox/LTER_2014_mipollica/LTER_sites_geoinfo/Sierra_Nevada



malla <- readOGR('/Users/ajpeluLap/Downloads/ecoinformatica_2015_2016-master/sesion_7_reto_final/nieve_MODIS/malla_MODIS.shp', 
                  layer='malla_MODIS', verbose = FALSE)


/Users/ajpeluLap/Downloads/ecoinformatica_2015_2016-master/sesion_7_reto_final/nieve_MODIS


setwd('/Users/ajpeluLap/Downloads/ecoinformatica_2015_2016-master/sesion_7_reto_final/nieve_MODIS')
malla <- readOGR(dsn= ".", layer='malla_MODIS')



# Read Protected Areas boundaries
eennpp <- readShapePoly('/Users/ajpeluLap/Downloads/EENNPP/InfGeografica/InfVectorial/Shapes/ED50_30/EENNPP.shp')
sn <- subset(eennpp, eennpp@data$NOMBRE == 'SIERRA NEVADA') 
sn <- subset(sn, sn@data$FIGURA == 'Espacio Natural')

# Set ED50 
proj4string(sn) <- CRS("+init=epsg:23030")  

enp <- rgdal::readOGR(dsn='/Users/ajpeluLap/Downloads/EENNPP/InfGeografica/InfVectorial/Shapes/ED50_30', 
                      layer = 'EENNPP')

proj4string(enp)

sn1  <- subset(enp, NOMBRE == 'SIERRA NEVADA' & FIGURA == 'Espacio Natural') 





```

